import{S as v}from"./Sidebar-460c4711.js";import"./TimeVote-20dc7c6f.js";import{N as U,F as w}from"./Footer-efae84de.js";import{a as u,S as b}from"./sweetalert2.all-1e3fb24f.js";import{P as y,D as B}from"./jquery.dataTables-11f5c627.js";import{r as f,b as i,f as l,g as t,i as m,n as C,l as h,c as S,z as H,A,F as k,y as _,B as D,C as g}from"./index-6973fbdc.js";const T={id:"wrapper"},j={id:"content-wrapper",class:"d-flex flex-column"},x={id:"content"},F={class:"container-fluid mt-4"},N=t("h1",{class:"h3 mb-0 text-gray-800 text-center mb-5"},"List User",-1),R={class:"row"},I=t("div",{class:"col-1"},null,-1),q={class:"col-10"},z=_('<div class="row mb-3"><div class="col-6"><button class="btn btn-warning me-2" data-toggle="modal" data-target="#addUser"><i class="bi bi-plus-circle-fill"></i> User </button></div><div class="col-6"></div></div>',1),L={class:"table-responsive"},V={key:0,class:"text-center"},P=t("thead",null,[t("tr",null,[t("th",{scope:"col",style:{width:"50px"}},"No"),t("th",{scope:"col"},"Aksi"),t("th",{scope:"col"},"Nama"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"Role"),t("th",{scope:"col"},"Status")])],-1),E={class:"row"},O={class:"col-6"},J=["onClick"],K=t("i",{class:"bi bi-pencil-square"},null,-1),G=[K],W={class:"col-6"},M=["onClick"],Q=t("i",{class:"bi bi-trash3"},null,-1),X=[Q],Y={key:0,class:"bi bi-hourglass-split fs-5 text-danger"},Z={key:1,class:"bi bi-check-circle-fill fs-5 text-success"},tt=t("div",{class:"col-1"},null,-1),at={class:"modal fade",id:"addUser",tabindex:"-1",role:"dialog","aria-labelledby":"addUserLabel","aria-hidden":"true"},et={class:"modal-dialog",role:"document"},st={class:"modal-content"},ot=_('<div class="modal-header"><h5 class="modal-title" id="addUserLabel">Tambah User</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="modal-body"><strong>Under Construction</strong></div>',2),nt={class:"modal-footer"},rt=t("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Batal ",-1),it={class:"modal fade",id:"editTransaksi",tabindex:"-1",role:"dialog","aria-labelledby":"editTransaksiLabel","aria-hidden":"true"},lt={class:"modal-dialog",role:"document"},dt={class:"modal-content"},ut=_('<div class="modal-header"><h5 class="modal-title" id="editTransaksiLabel">Edit User</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="modal-body"><strong>Under Construction</strong></div>',2),ct={class:"modal-footer"},ht=t("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Batal ",-1);y.use(B);const gt={data(){return{users:[],formUser:{pemberi_hutang:"",jumlah_hutang:"",tanggal_hutang:"",tgl_jatuh_tempo:"",catatan:""},formUpdateUser:{pemberi_hutang:"",jumlah_hutang:"",tanggal_hutang:"",tgl_jatuh_tempo:"",catatan:""},ready:!1,transaksi_id:"",selectedPenerima:"",user_id:"",hutang_id:""}},methods:{setDataUpdate(a,e,n,d,o,r){this.formUpdateUser.pemberi_hutang=a,this.formUpdateUser.jumlah_hutang=e,this.formUpdateUser.tanggal_hutang=n,this.formUpdateUser.tgl_jatuh_tempo=o,this.formUpdateUser.catatan=d,this.hutang_id=r},createHutang(){this.ready=!1;const a=new FormData;a.append("pemberi_hutang",this.formUser.pemberi_hutang),a.append("jumlah_hutang",this.formUser.jumlah_hutang),a.append("tanggal_hutang",this.formUser.tanggal_hutang),a.append("tgl_jatuh_tempo",this.formUser.tgl_jatuh_tempo),a.append("catatan",this.formUser.catatan),a.append("id_user",this.user_id),u.post("https://backend.keuanganfpti.com/api/create-hutangpiutang",a,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(e=>{console.log(e.data),this.formUser={jumlah_transaksi:"",deskripsi:"",tgl_transaksi:"",selectedPenerima:""},this.showAlert("Request Success","Hutang berhasil buat","success"),this.fetchDataHutang()}).catch(e=>{this.showAlert("Request Failed","Hutang gagal buat","error"),console.error(e),this.ready=!0})},updateHutang(){this.ready=!1;const a=new FormData;a.append("pemberi_hutang",this.formUpdateUser.pemberi_hutang),a.append("jumlah_hutang",this.formUpdateUser.jumlah_hutang),a.append("tanggal_hutang",this.formUpdateUser.tanggal_hutang),a.append("tgl_jatuh_tempo",this.formUpdateUser.tgl_jatuh_tempo),a.append("catatan",this.formUpdateUser.catatan),a.append("id_user",this.user_id),u.post(`https://backend.keuanganfpti.com/api/update-hutangpiutang/${this.hutang_id}`,a,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(e=>{console.log(e.data),this.formUser={nama_mapel:""},this.showAlert("Request Success","Hutang berhasil diupdate","success"),this.fetchDataHutang()}).catch(e=>{this.showAlert("Request Failed","Hutang gagal diupdate","error"),console.error(e),this.ready=!0})},deleteHutang(a){this.ready=!1,u.delete(`https://backend.keuanganfpti.com/api/delete-hutangpiutang/${a}`,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(e=>{console.log(e.data),this.showAlert("Request Success","Hutang berhasil dihapus","success"),this.fetchDataHutang()}).catch(e=>{this.showAlert("Request Failed","Hutang gagal dihapus","error"),console.error(e),this.ready=!0})},async fetchDataHutang(){try{const a=await u.get("https://backend.keuanganfpti.com/api/list-penerima",{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.users=a.data.data,this.ready=!0}catch(a){console.error(a)}},async bayarHutang(a){try{const e=await u.post(`https://backend.keuanganfpti.com/api/bayar-hutangpiutang/${a}`,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.showAlert("Request Success","Hutang berhasil dibayarkan","success"),this.ready=!0}catch(e){console.error(e),this.showAlert("Request Failed","Gagal membayar hutang, pastikan saldo anda cukup","error")}},showAlert(a,e,n){this.$swal({title:a,text:e,icon:n}).then(()=>{$("#addUser").modal("hide"),$("#editTransaksi").modal("hide")})},konfirmasiBayar(a,e){b.fire({title:`Apakah Anda yakin ingin membayar Hutang ke ${e}?`,text:"Pastikan saldo anda cukup.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#fac800",cancelButtonColor:"#d33",confirmButtonText:"Bayar",cancelButtonText:"Batal"}).then(n=>{n.isConfirmed&&this.bayarHutang(a)})},konfirmasiDelete(a,e){b.fire({title:`Apakah Anda yakin ingin menghapus hutang dari ${e}?`,text:"Anda akan keluar dari akun ini.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#061387",confirmButtonText:"Hapus",cancelButtonText:"Batal"}).then(n=>{n.isConfirmed&&this.deleteHutang(a)})}},computed:{formatCurrency:function(){return function(a){return a?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a):"Rp 0,00"}}},created(){const a=sessionStorage.getItem("token");if(a)try{const[e,n]=a.split("."),d=JSON.parse(atob(e)),o=atob(n),r=JSON.parse(atob(a.split(".")[1])),s=r.exp,c=new Date(s*1e3);console.log("Waktu Kedaluwarsa (UTC):",c.toUTCString()),new Date>c?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const p=r.level;this.user_id=r.id,console.log("ini idddd:",this.user_id),p!=="1"?this.$router.push("/unauthorized"):(!d||!o)&&this.$router.push("/"),this.fetchDataHutang()}catch(e){console.error("Error decoding token:",e),this.$router.push("/")}else this.$router.push("/")}},yt=Object.assign(gt,{__name:"User",setup(a){const e=f(!1),n=f(""),d=()=>{e.value=!e.value,n.value=e.value?"toggle-sidebar":""};return(o,r)=>(i(),l(k,null,[t("div",T,[m(v,{class:C(n.value)},null,8,["class"]),t("div",j,[t("div",x,[m(U,{onToggleSidebar:d}),t("div",F,[N,t("div",R,[I,t("div",q,[z,t("div",L,[o.ready?h("",!0):(i(),l("p",V,"Loading...")),o.ready?(i(),S(A(y),{key:1,class:"display table table-striped"},{default:H(()=>[P,t("tbody",null,[(i(!0),l(k,null,D(o.users,(s,c)=>(i(),l("tr",{key:s.id},[t("td",null,g(c+1),1),t("td",null,[t("div",E,[t("div",O,[t("button",{type:"button",class:"btn btn-warning","data-toggle":"modal","data-target":"#editTransaksi",onClick:p=>o.setDataUpdate(s.pemberi_hutang,s.jumlah_hutang,s.tanggal_hutang,s.catatan,s.tgl_jatuh_tempo,s.id)},G,8,J)]),t("div",W,[t("button",{onClick:p=>o.konfirmasiDelete(s.id,s.pemberi_hutang),class:"btn btn-danger customDetail"},X,8,M)])])]),t("td",null,g(s.name),1),t("td",null,g(s.email),1),t("td",null,g(s.level=="0"?"User":"Admin"),1),t("td",null,[s.status=="0"?(i(),l("i",Y)):h("",!0),s.status=="1"?(i(),l("i",Z)):h("",!0)])]))),128))])]),_:1})):h("",!0)])]),tt])])]),m(w)])]),t("div",at,[t("div",et,[t("div",st,[ot,t("div",nt,[rt,t("button",{type:"button",class:"btn blueButton",onClick:r[0]||(r[0]=(...s)=>o.createHutang&&o.createHutang(...s))}," Simpan ")])])])]),t("div",it,[t("div",lt,[t("div",dt,[ut,t("div",ct,[ht,t("button",{type:"button",class:"btn blueButton",onClick:r[1]||(r[1]=(...s)=>o.updateHutang&&o.updateHutang(...s))}," Simpan ")])])])])],64))}});export{yt as default};
