import{r as b,b as u,f as p,g as a,i as _,n as v,l as f,c as y,z as U,A as D,j as r,v as i,F as g,y as w,B as C,C as m}from"./index-6a3474be.js";import{S}from"./Sidebar-3a40d533.js";import"./TimeVote-2fd43bb6.js";import{N as B,F as A}from"./Footer-3c1305de.js";import{a as k,S as T}from"./sweetalert2.all-1e3fb24f.js";import{P,D as j}from"./jquery.dataTables-f52bf5d6.js";const V={id:"wrapper"},F={id:"content-wrapper",class:"d-flex flex-column"},N={id:"content"},I={class:"container-fluid mt-4"},R=a("h1",{class:"h3 mb-0 text-gray-800 text-center mb-5"},"List Dana External",-1),q={class:"row"},z=a("div",{class:"col-1"},null,-1),E={class:"col-10"},L=w('<div class="row mb-3"><div class="col-6"><button class="btn btn-warning me-2" data-toggle="modal" data-target="#addPemasukan"><i class="bi bi-plus-circle-fill"></i> Dana </button></div><div class="col-6"></div></div>',1),M={class:"table-responsive"},x={key:0,class:"text-center"},J=a("thead",null,[a("tr",null,[a("th",{scope:"col",style:{width:"50px"}},"No"),a("th",{scope:"col"},"Aksi"),a("th",{scope:"col"},"Pemberi Dana"),a("th",{scope:"col"},"Jumlah Dana"),a("th",{scope:"col"},"Tanggal Masuk"),a("th",{scope:"col"},"Keterangan")])],-1),K={class:"row"},O={class:"col-6"},H=["onClick"],W=a("i",{class:"bi bi-pencil-square"},null,-1),G=[W],Q={class:"col-6"},X=["onClick"],Y=a("i",{class:"bi bi-trash3"},null,-1),Z=[Y],aa=a("div",{class:"col-1"},null,-1),ea={class:"modal fade",id:"addPemasukan",tabindex:"-1",role:"dialog","aria-labelledby":"addPemasukanLabel","aria-hidden":"true"},sa={class:"modal-dialog",role:"document"},ta={class:"modal-content"},na=a("div",{class:"modal-header"},[a("h5",{class:"modal-title",id:"addPemasukanLabel"}," Form Pemasukan "),a("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[a("span",{"aria-hidden":"true"},"×")])],-1),oa={class:"modal-body"},la={class:"mb-3"},ra=a("label",{for:"ketua",class:"form-label"},"Sumber Dana",-1),ia={class:"mb-3"},da=a("label",{for:"ketua",class:"form-label"},"Jumlah Pengeluaran",-1),ua={class:"mb-3"},ma=a("label",{for:"ketua",class:"form-label"},"Tanggal Transaksi",-1),ca={class:"mb-3"},pa=a("label",{for:"keterangan",class:"form-label"},"Keterangan",-1),ka={class:"modal-footer"},ha=a("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Batal ",-1),_a={class:"modal fade",id:"editPemasukan",tabindex:"-1",role:"dialog","aria-labelledby":"editMapelLabel","aria-hidden":"true"},ba={class:"modal-dialog",role:"document"},fa={class:"modal-content"},ga=a("div",{class:"modal-header"},[a("h5",{class:"modal-title",id:"editMapelLabel"},"Edit Pemasukan External"),a("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[a("span",{"aria-hidden":"true"},"×")])],-1),Pa={class:"modal-body"},va={class:"mb-3"},ya=a("label",{for:"ketua",class:"form-label"},"Pemberi Dana",-1),Ua={class:"mb-3"},Da=a("label",{for:"ketua",class:"form-label"},"Jumlah Pengeluaran",-1),wa={class:"mb-3"},Ca=a("label",{for:"ketua",class:"form-label"},"Tanggal Transaksi",-1),Sa={class:"mb-3"},Ba=a("label",{for:"keterangan",class:"form-label"},"Keterangan",-1),Aa={class:"modal-footer"},Ta=a("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Batal ",-1);P.use(j);const ja={data(){return{pemasukan:[],formPemasukan:{pemberi_dana:"",jumlah_transaksi:"",deskripsi:"",tgl_transaksi:"",id_penerima:""},formUpdatePemasukan:{pemberi_dana:"",jumlah_transaksi:"",deskripsi:"",tgl_transaksi:"",id:""},ready:!1,user_id:""}},methods:{setDataUpdate(s,n,l,d,t){this.formUpdatePemasukan.pemberi_dana=s,this.formUpdatePemasukan.jumlah_transaksi=n,this.formUpdatePemasukan.tgl_transaksi=l,this.formUpdatePemasukan.deskripsi=d,this.formUpdatePemasukan.id=t},createPemasukan(){this.ready=!1;const s=new FormData;s.append("pemberi_dana",this.formPemasukan.pemberi_dana),s.append("jumlah_transaksi",this.formPemasukan.jumlah_transaksi),s.append("deskripsi",this.formPemasukan.deskripsi),s.append("tgl_transaksi",this.formPemasukan.tgl_transaksi),s.append("id_penerima",this.user_id),k.post("https://backend.keuanganfpti.com/api/external-transaksi",s,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(n=>{console.log(n.data),this.formPemasukan={pemberi_dana:"",jumlah_transaksi:"",deskripsi:"",tgl_transaksi:"",id_penerima:""},this.showAlert("Request Success","Pemasukan berhasil buat","success"),this.fetchDataPemasukan()}).catch(n=>{this.showAlert("Request Failed","Pemasukan gagal buat","error"),console.error(n),this.ready=!0})},updatePemasukan(){this.ready=!1;const s=new FormData;s.append("pemberi_dana",this.formUpdatePemasukan.pemberi_dana),s.append("jumlah_transaksi",this.formUpdatePemasukan.jumlah_transaksi),s.append("tgl_transaksi",this.formUpdatePemasukan.tgl_transaksi),s.append("deskripsi",this.formUpdatePemasukan.deskripsi),s.append("id_penerima",this.user_id),k.post(`https://backend.keuanganfpti.com/api/update-external/${this.formUpdatePemasukan.id}`,s,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(n=>{console.log(n.data),this.formPemasukan={nama_mapel:""},this.showAlert("Request Success","Pemasukan berhasil diupdate","success"),this.fetchDataPemasukan()}).catch(n=>{this.showAlert("Request Failed","Pemasukan gagal diupdate","error"),console.error(n),this.ready=!0})},deletePemasukan(s){this.ready=!1,k.delete(`https://backend.keuanganfpti.com/api/delete-external/${s}`,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(n=>{console.log(n.data),this.showAlert("Request Success","Pemasukan berhasil dihapus","success"),this.fetchDataPemasukan()}).catch(n=>{this.showAlert("Request Failed","Pemasukan gagal dihapus","error"),console.error(n),this.ready=!0})},async fetchDataPemasukan(){try{const s=await k.get("https://backend.keuanganfpti.com/api/list-external/2",{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.pemasukan=s.data.data,this.ready=!0}catch(s){this.ready=!0,console.error(s)}},showAlert(s,n,l){this.$swal({title:s,text:n,icon:l}).then(()=>{$("#addPemasukan").modal("hide"),$("#editPemasukan").modal("hide")})},konfirmasiDelete(s,n){T.fire({title:`Apakah Anda yakin ingin menghapus Pemasukan ${n}?`,text:"Anda akan keluar dari akun ini.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#061387",confirmButtonText:"Hapus",cancelButtonText:"Batal"}).then(l=>{l.isConfirmed&&this.deletePemasukan(s)})}},computed:{formatCurrency:function(){return function(s){return s?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(s):"Rp 0,00"}}},created(){const s=sessionStorage.getItem("token");if(s)try{const[n,l]=s.split("."),d=JSON.parse(atob(n)),t=atob(l),o=JSON.parse(atob(s.split(".")[1])),e=o.exp,c=new Date(e*1e3);console.log("Waktu Kedaluwarsa (UTC):",c.toUTCString()),new Date>c?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const h=o.level;this.user_id=o.id,console.log("ini idddd:",this.user_id),h!=="1"?this.$router.push("/unauthorized"):(!d||!t)&&this.$router.push("/"),this.fetchDataPemasukan()}catch(n){console.error("Error decoding token:",n),this.$router.push("/")}else this.$router.push("/")}},qa=Object.assign(ja,{__name:"PemasukanEksternal",setup(s){const n=b(!1),l=b(""),d=()=>{n.value=!n.value,l.value=n.value?"toggle-sidebar":""};return(t,o)=>(u(),p(g,null,[a("div",V,[_(S,{class:v(l.value)},null,8,["class"]),a("div",F,[a("div",N,[_(B,{onToggleSidebar:d}),a("div",I,[R,a("div",q,[z,a("div",E,[L,a("div",M,[t.ready?f("",!0):(u(),p("p",x,"Loading...")),t.ready?(u(),y(D(P),{key:1,class:"display table table-striped"},{default:U(()=>[J,a("tbody",null,[(u(!0),p(g,null,C(t.pemasukan,(e,c)=>(u(),p("tr",{key:e.id},[a("td",null,m(c+1),1),a("td",null,[a("div",K,[a("div",O,[a("button",{type:"button",class:"btn btn-warning","data-toggle":"modal","data-target":"#editPemasukan",onClick:h=>t.setDataUpdate(e.pemberi_dana,e.jumlah_transaksi,e.tgl_transaksi,e.deskripsi,e.id)},G,8,H)]),a("div",Q,[a("button",{onClick:h=>t.konfirmasiDelete(e.id,e.pemberi_dana),class:"btn btn-danger customDetail"},Z,8,X)])])]),a("td",null,m(e.pemberi_dana),1),a("td",null,m(t.formatCurrency(e.jumlah_transaksi)),1),a("td",null,m(e.tgl_transaksi),1),a("td",null,m(e.deskripsi),1)]))),128))])]),_:1})):f("",!0)])]),aa])])]),_(A)])]),a("div",ea,[a("div",sa,[a("div",ta,[na,a("div",oa,[a("form",null,[a("div",la,[ra,r(a("input",{type:"text",class:"form-control",id:"mapel",placeholder:"masukkan sumber dana","onUpdate:modelValue":o[0]||(o[0]=e=>t.formPemasukan.pemberi_dana=e)},null,512),[[i,t.formPemasukan.pemberi_dana]])]),a("div",ia,[da,r(a("input",{type:"number",class:"form-control",id:"mapel",placeholder:"masukkan nominal pengeluaran","onUpdate:modelValue":o[1]||(o[1]=e=>t.formPemasukan.jumlah_transaksi=e)},null,512),[[i,t.formPemasukan.jumlah_transaksi]])]),a("div",ua,[ma,r(a("input",{type:"date",class:"form-control",id:"mapel","onUpdate:modelValue":o[2]||(o[2]=e=>t.formPemasukan.tgl_transaksi=e)},null,512),[[i,t.formPemasukan.tgl_transaksi]])]),a("div",ca,[pa,r(a("textarea",{class:"form-control",id:"keterangan",placeholder:"Masukkan keterangan","onUpdate:modelValue":o[3]||(o[3]=e=>t.formPemasukan.deskripsi=e)},null,512),[[i,t.formPemasukan.deskripsi]])])])]),a("div",ka,[ha,a("button",{type:"button",class:"btn blueButton",onClick:o[4]||(o[4]=(...e)=>t.createPemasukan&&t.createPemasukan(...e))}," Simpan ")])])])]),a("div",_a,[a("div",ba,[a("div",fa,[ga,a("div",Pa,[a("form",null,[a("div",va,[ya,r(a("input",{type:"text",class:"form-control",id:"mapel",placeholder:"masukkan sumber dana","onUpdate:modelValue":o[5]||(o[5]=e=>t.formUpdatePemasukan.pemberi_dana=e)},null,512),[[i,t.formUpdatePemasukan.pemberi_dana]])]),a("div",Ua,[Da,r(a("input",{type:"number",class:"form-control",id:"mapel",placeholder:"masukkan nominal pengeluaran","onUpdate:modelValue":o[6]||(o[6]=e=>t.formUpdatePemasukan.jumlah_transaksi=e)},null,512),[[i,t.formUpdatePemasukan.jumlah_transaksi]])]),a("div",wa,[Ca,r(a("input",{type:"date",class:"form-control",id:"mapel","onUpdate:modelValue":o[7]||(o[7]=e=>t.formUpdatePemasukan.tgl_transaksi=e)},null,512),[[i,t.formUpdatePemasukan.tgl_transaksi]])]),a("div",Sa,[Ba,r(a("textarea",{class:"form-control",id:"keterangan",placeholder:"Masukkan keterangan","onUpdate:modelValue":o[8]||(o[8]=e=>t.formUpdatePemasukan.deskripsi=e)},null,512),[[i,t.formUpdatePemasukan.deskripsi]])])])]),a("div",Aa,[Ta,a("button",{type:"button",class:"btn blueButton",onClick:o[9]||(o[9]=(...e)=>t.updatePemasukan&&t.updatePemasukan(...e))}," Simpan ")])])])])],64))}});export{qa as default};
