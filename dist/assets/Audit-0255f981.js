import{r as f,b as l,f as r,g as t,i as h,n as y,l as b,c as k,z as w,A as C,j as g,v as m,F as A,y as S,B,C as u}from"./index-d7a97f84.js";import{S as D}from"./Sidebar-f612c971.js";import"./TimeVote-538d8ef6.js";import{N as T,F}from"./Footer-1fc0e7ab.js";import{a as p,S as N}from"./sweetalert2.all-1e3fb24f.js";import{P as v,D as V}from"./jquery.dataTables-c952401e.js";const x={id:"wrapper"},I={id:"content-wrapper",class:"d-flex flex-column"},R={id:"content"},U={class:"container-fluid mt-4"},z=t("h1",{class:"h3 mb-0 text-gray-800 text-center mb-5"}," Realisasi Anggaran ",-1),q={class:"row"},L=t("div",{class:"col-1"},null,-1),K={class:"col-10"},O=S('<div class="row mb-3"><div class="col-6"><button class="btn btn-warning me-2" data-toggle="modal" data-target="#addAudit"><i class="bi bi-plus-circle-fill"></i> Audit </button></div><div class="col-6"></div></div>',1),P={class:"table-responsive"},j={key:0,class:"text-center"},E=t("thead",null,[t("tr",null,[t("th",{scope:"col",style:{width:"50px"}},"No"),t("th",{scope:"col"},"Aksi"),t("th",{scope:"col"},"Auditor"),t("th",{scope:"col"},"Tanggal Audit"),t("th",{scope:"col"},"Tahun Anggaran")])],-1),J={class:"row"},H={class:"col-6"},M=["href"],W=t("i",{class:"bi bi-eye-fill"},null,-1),G=[W],Q={class:"col-6"},X=["onClick"],Y=t("i",{class:"bi bi-trash3"},null,-1),Z=[Y],tt=t("div",{class:"col-1"},null,-1),at={class:"modal fade",id:"addAudit",tabindex:"-1",role:"dialog","aria-labelledby":"addAuditLabel","aria-hidden":"true"},et={class:"modal-dialog",role:"document"},st={class:"modal-content"},ot=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"addAuditLabel"},"Form Audit"),t("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[t("span",{"aria-hidden":"true"},"Ã—")])],-1),it={class:"modal-body"},nt={class:"mb-3"},lt=t("label",{for:"auditor",class:"form-label"},"Auditor",-1),dt={class:"mb-3"},rt=t("label",{for:"tanggalAudit",class:"form-label"},"Tanggal Audit",-1),ut={class:"mb-3"},ct=t("label",{for:"tahunAnggaran",class:"form-label"},"Tahun Anggaran",-1),ht={class:"mb-3"},gt=t("label",{for:"ketua",class:"form-label"},"File Audit",-1),mt={class:"modal-footer"},pt=t("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Batal ",-1);v.use(V);const _t={data(){return{audits:[],anggarans:[],formAudit:{auditor:"",tanggal_audit:"",tahun_anggaran:"",file_audit:null},ready:!1,user_id:"",selectedAnggaran:""}},methods:{createAudit(){this.ready=!1;const a=new FormData;a.append("auditor",this.formAudit.auditor),a.append("tanggal_audit",this.formAudit.tanggal_audit),a.append("tahun_anggaran",this.formAudit.tahun_anggaran),a.append("file_audit",this.formAudit.file_audit),p.post("https://backend.keuanganfpti.com/api/create-audit",a,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(e=>{console.log(e.data),this.showAlert("Request Success","Audit berhasil buat","success"),this.fetchDataAudit()}).catch(e=>{this.showAlert("Request Failed","Audit gagal buat","error"),console.error(e),this.ready=!0})},deleteAudit(a){this.ready=!1,p.delete(`https://backend.keuanganfpti.com/api/delete-audit/${a}`,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(e=>{console.log(e.data),this.showAlert("Request Success","Audit berhasil dihapus","success"),this.fetchDataAudit()}).catch(e=>{this.showAlert("Request Failed","Audit gagal dihapus","error"),console.error(e),this.ready=!0})},async fetchDataAudit(){try{const a=await p.get("https://backend.keuanganfpti.com/api/list-audit",{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.audits=a.data.data,this.ready=!0}catch(a){this.ready=!0,console.error(a)}},showAlert(a,e,n){this.$swal({title:a,text:e,icon:n}).then(()=>{$("#addAudit").modal("hide"),$("#editRealisasi").modal("hide")})},konfirmasiDelete(a,e){N.fire({title:"Konfirmasi Penghapusan",text:`Apakah Anda yakin ingin menghapus laporan audit tahun ${e}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#061387",confirmButtonText:"Hapus",cancelButtonText:"Batal"}).then(n=>{n.isConfirmed&&this.deleteAudit(a)})},handleFileUpload(a){this.formAudit.file_audit=a.target.files[0]}},computed:{formatCurrency:function(){return function(a){return a?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a):"Rp 0,00"}}},created(){const a=sessionStorage.getItem("token");if(a)try{const[e,n]=a.split("."),c=JSON.parse(atob(e)),o=atob(n),i=JSON.parse(atob(a.split(".")[1])),s=i.exp,d=new Date(s*1e3);console.log("Waktu Kedaluwarsa (UTC):",d.toUTCString()),new Date>d?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const _=i.level;this.user_id=i.id,console.log("ini idddd:",this.user_id),_!=="1"?this.$router.push("/unauthorized"):(!c||!o)&&this.$router.push("/"),this.fetchDataAudit()}catch(e){console.error("Error decoding token:",e),this.$router.push("/")}else this.$router.push("/")}},wt=Object.assign(_t,{__name:"Audit",setup(a){const e=f(!1),n=f(""),c=()=>{e.value=!e.value,n.value=e.value?"toggle-sidebar":""};return(o,i)=>(l(),r(A,null,[t("div",x,[h(D,{class:y(n.value)},null,8,["class"]),t("div",I,[t("div",R,[h(T,{onToggleSidebar:c}),t("div",U,[z,t("div",q,[L,t("div",K,[O,t("div",P,[o.ready?b("",!0):(l(),r("p",j,"Loading...")),o.ready?(l(),k(C(v),{key:1,class:"display table table-striped"},{default:w(()=>[E,t("tbody",null,[(l(!0),r(A,null,B(o.audits,(s,d)=>(l(),r("tr",{key:s.id},[t("td",null,u(d+1),1),t("td",null,[t("div",J,[t("div",H,[t("a",{href:"https://backend.keuanganfpti.com/storage/audit_files/"+s.file_audit,target:"_blank",class:"btn btn-warning"},G,8,M)]),t("div",Q,[t("button",{onClick:_=>o.konfirmasiDelete(s.id,s.tahun_anggaran),class:"btn btn-danger customDetail"},Z,8,X)])])]),t("td",null,u(s.auditor),1),t("td",null,u(s.tanggal_audit),1),t("td",null,u(s.tahun_anggaran),1)]))),128))])]),_:1})):b("",!0)])]),tt])])]),h(F)])]),t("div",at,[t("div",et,[t("div",st,[ot,t("div",it,[t("form",null,[t("div",nt,[lt,g(t("input",{type:"text",class:"form-control",id:"auditor",placeholder:"masukkan auditor","onUpdate:modelValue":i[0]||(i[0]=s=>o.formAudit.auditor=s)},null,512),[[m,o.formAudit.auditor]])]),t("div",dt,[rt,g(t("input",{type:"date",class:"form-control",id:"tanggalAudit","onUpdate:modelValue":i[1]||(i[1]=s=>o.formAudit.tanggal_audit=s)},null,512),[[m,o.formAudit.tanggal_audit]])]),t("div",ut,[ct,g(t("input",{type:"text",class:"form-control",id:"tahunAnggaran",placeholder:"masukkan tahun anggaran","onUpdate:modelValue":i[2]||(i[2]=s=>o.formAudit.tahun_anggaran=s)},null,512),[[m,o.formAudit.tahun_anggaran]])]),t("div",ht,[gt,t("input",{type:"file",class:"form-control",id:"mapel",onChange:i[3]||(i[3]=(...s)=>o.handleFileUpload&&o.handleFileUpload(...s))},null,32)])])]),t("div",mt,[pt,t("button",{type:"button",class:"btn blueButton",onClick:i[4]||(i[4]=(...s)=>o.createAudit&&o.createAudit(...s))}," Simpan ")])])])])],64))}});export{wt as default};
