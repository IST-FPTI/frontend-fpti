import{r as v,b as l,f as r,g as a,i as b,n as w,l as _,c as B,G as U,J as C,j as d,v as p,L as P,F as f,H as k,K as S,I as u}from"./index-1c32a6d8.js";import{S as D,N as A,F as V}from"./Footer-663f5f32.js";import{P as y,D as T}from"./TimeVote-b108e8d3.js";import{a as c}from"./_commonjsHelpers-34c3cec1.js";import{S as j}from"./sweetalert2.all-777e80f8.js";const N={id:"wrapper"},I={id:"content-wrapper",class:"d-flex flex-column"},E={id:"content"},F={class:"container-fluid mt-4"},R=a("h1",{class:"h3 mb-0 text-gray-800 text-center mb-5"},"Data Piutang",-1),q={class:"row"},z=a("div",{class:"col-1"},null,-1),H={class:"col-10"},J=S('<div class="row mb-3"><div class="col-6"><button class="btn btn-warning me-2" data-toggle="modal" data-target="#addPiutang"><i class="bi bi-plus-circle-fill"></i> Buat Piutang </button></div><div class="col-6"></div></div>',1),L={class:"table-responsive"},K={key:0,class:"text-center"},O=a("thead",null,[a("tr",null,[a("th",{scope:"col",style:{width:"50px"}},"No"),a("th",{scope:"col"},"Aksi"),a("th",{scope:"col"},"Peminjam"),a("th",{scope:"col"},"No Hp"),a("th",{scope:"col"},"Jumlah Pinjaman"),a("th",{scope:"col"},"Deskripsi Pinjaman"),a("th",{scope:"col"},"Status")])],-1),G={class:"row"},M={class:"col-4"},W=["onClick"],Q=a("i",{class:"bi bi-cash-coin"},null,-1),X=[Q],Y={class:"col-4"},Z=["onClick"],x=a("i",{class:"bi bi-pencil-square"},null,-1),aa=[x],ta={class:"col-4"},ea=["onClick"],sa=a("i",{class:"bi bi-trash3"},null,-1),na=[sa],oa={key:0,class:"bi bi-hourglass-split fs-5 text-danger"},ia={key:1,class:"bi bi-check-circle-fill fs-5 text-success"},la=a("div",{class:"col-1"},null,-1),ra={class:"modal fade",id:"addPiutang",tabindex:"-1",role:"dialog","aria-labelledby":"addPiutangLabel","aria-hidden":"true"},da={class:"modal-dialog",role:"document"},ua={class:"modal-content"},pa=a("div",{class:"modal-header"},[a("h5",{class:"modal-title",id:"addPiutangLabel"},"Buat Piutang"),a("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[a("span",{"aria-hidden":"true"},"×")])],-1),ca={class:"modal-body"},ma={class:"mb-3"},ha=a("label",{for:"ketua",class:"form-label"},"Peminjam",-1),ga={class:"mb-3"},_a=a("label",{for:"ketua",class:"form-label"},"Nomor HP",-1),fa={class:"mb-3"},ba=a("label",{for:"ketua",class:"form-label"},"Jumlah Pinjaman",-1),ka={class:"mb-3"},va=a("label",{for:"mission",class:"form-label"},"Events",-1),Pa=a("option",{value:"",disabled:"",selected:""},"Pilih Event",-1),ja=["value"],ya={class:"mb-3"},wa=a("label",{for:"keterangan",class:"form-label"},"Deskripsi Pinjaman",-1),Ba={class:"modal-footer"},Ua=a("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Batal ",-1),Ca={class:"modal fade",id:"aditPiutang",tabindex:"-1",role:"dialog","aria-labelledby":"aditPiutangLabel","aria-hidden":"true"},Sa={class:"modal-dialog",role:"document"},Da={class:"modal-content"},Aa=a("div",{class:"modal-header"},[a("h5",{class:"modal-title",id:"aditPiutangLabel"},"Edit Hutang"),a("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[a("span",{"aria-hidden":"true"},"×")])],-1),Va={class:"modal-body"},$a={class:"mb-3"},Ta=a("label",{for:"ketua",class:"form-label"},"Peminjam",-1),Na={class:"mb-3"},Ia=a("label",{for:"ketua",class:"form-label"},"Nomor HP",-1),Ea={class:"mb-3"},Fa=a("label",{for:"ketua",class:"form-label"},"Jumlah Pinjaman",-1),Ra={class:"mb-3"},qa=a("label",{for:"mission",class:"form-label"},"Events",-1),za=a("option",{value:"",disabled:"",selected:""},"Pilih Event",-1),Ha=["value"],Ja={class:"mb-3"},La=a("label",{for:"keterangan",class:"form-label"},"Deskripsi Pinjaman",-1),Ka={class:"modal-footer"},Oa=a("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal"}," Batal ",-1);y.use(T);const Ga={data(){return{piutangs:[],events:[],formPiutang:{pihak_peminjam:"",no_hp:"",jumlah_pinjaman:"",deskripsi_pinjaman:""},formUpdatePiutang:{pihak_peminjam:"",no_hp:"",jumlah_pinjaman:"",deskripsi_pinjaman:"",id_piutang:""},ready:!1,selectedEvent:"",user_id:""}},methods:{setDataUpdate(e,n,i,m,s){this.formUpdatePiutang.pihak_peminjam=e,this.formUpdatePiutang.no_hp=n,this.formUpdatePiutang.jumlah_pinjaman=i,this.formUpdatePiutang.deskripsi_pinjaman=m,this.formUpdatePiutang.id_piutang=s},createPiutang(){this.ready=!1;const e=new FormData;e.append("pihak_peminjam",this.formPiutang.pihak_peminjam),e.append("no_hp",this.formPiutang.no_hp),e.append("jumlah_pinjaman",this.formPiutang.jumlah_pinjaman),e.append("deskripsi_pinjaman",this.formPiutang.deskripsi_pinjaman),e.append("id_event",this.selectedEvent),c.post("https://backend.keuanganfpti.com/api/create-piutang",e,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(n=>{console.log(n.data),this.formPiutang={keperluan_hutang:"",jumlah_hutang:"",tanggal_hutang:"",tanggal_jatuh_tempo:"",deskripsi_hutang:"",selectedEvent:""},this.showAlert("Request Success","Piutang berhasil buat","success"),this.fetchDataPiutang()}).catch(n=>{this.showAlert("Request Failed","Piutang gagal buat","error"),console.error(n),this.ready=!0})},updatePiutang(){this.ready=!1;const e=new FormData;e.append("pihak_peminjam",this.formUpdatePiutang.pihak_peminjam),e.append("no_hp",this.formUpdatePiutang.no_hp),e.append("jumlah_pinjaman",this.formUpdatePiutang.jumlah_pinjaman),e.append("deskripsi_pinjaman",this.formUpdatePiutang.deskripsi_pinjaman),e.append("id_event",this.selectedEvent),c.post(`https://backend.keuanganfpti.com/api/update-piutang/${this.formUpdatePiutang.id_piutang}`,e,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(n=>{console.log(n.data),this.showAlert("Request Success","Piutang berhasil diupdate","success"),this.fetchDataPiutang()}).catch(n=>{this.showAlert("Request Failed","Piutang gagal diupdate","error"),console.error(n),this.ready=!0})},deletePiutang(e){this.ready=!1,c.delete(`https://backend.keuanganfpti.com/api/delete-piutang/${e}`,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+sessionStorage.getItem("token")}}).then(n=>{console.log(n.data),this.showAlert("Request Success","Piutang berhasil dihapus","success"),this.fetchDataPiutang()}).catch(n=>{this.showAlert("Request Failed","Piutang gagal dihapus","error"),console.error(n),this.ready=!0})},async fetchDataPiutang(){try{const e=await c.get("https://backend.keuanganfpti.com/api/list-piutang",{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.piutangs=e.data.data,this.ready=!0}catch(e){this.ready=!0,console.error(e)}},async fetchDataActiveEvent(){try{const e=await c.get("https://backend.keuanganfpti.com/api/event-active",{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.events=e.data.data}catch(e){console.error(e)}},async bayarPiutang(e){try{const n=await c.post(`https://backend.keuanganfpti.com/api/bayar-piutang/${e}`,{headers:{Authorization:"Bearer "+sessionStorage.getItem("token")}});this.showAlert("Request Success","Piutang berhasil dibayarkan","success"),this.ready=!0}catch(n){console.error(n),this.showAlert("Request Failed","Gagal membayar hutang, pastikan saldo anda cukup","error")}},showAlert(e,n,i){this.$swal({title:e,text:n,icon:i}).then(()=>{$("#addPiutang").modal("hide"),$("#aditPiutang").modal("hide")})},konfirmasiBayar(e,n){j.fire({title:`Apakah Anda yakin ${n} sudah membayar hutang?`,text:"Saldo anda akan dikembalikan.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#fac800",cancelButtonColor:"#d33",confirmButtonText:"Bayar",cancelButtonText:"Batal"}).then(i=>{i.isConfirmed&&this.bayarPiutang(e)})},konfirmasi(e,n){j.fire({title:"Konfirmasi Penghapusan",text:`Apakah Anda yakin ingin menghapus piutang ${n}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#061387",confirmButtonText:"Hapus",cancelButtonText:"Batal"}).then(i=>{i.isConfirmed&&this.deletePiutang(e)})}},computed:{formatCurrency:function(){return function(e){return e?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e):"Rp 0,00"}}},created(){const e=sessionStorage.getItem("token");if(e)try{const[n,i]=e.split("."),m=JSON.parse(atob(n)),s=atob(i),o=JSON.parse(atob(e.split(".")[1])),t=o.exp,h=new Date(t*1e3);console.log("Waktu Kedaluwarsa (UTC):",h.toUTCString()),new Date>h?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const g=o.level;this.user_id=o.id,console.log("ini idddd:",this.user_id),g!=="1"?this.$router.push("/unauthorized"):(!m||!s)&&this.$router.push("/"),this.fetchDataPiutang(),this.fetchDataActiveEvent()}catch(n){console.error("Error decoding token:",n),this.$router.push("/")}else this.$router.push("/")}},Za=Object.assign(Ga,{__name:"Piutang",setup(e){const n=v(!1),i=v(""),m=()=>{n.value=!n.value,i.value=n.value?"toggle-sidebar":""};return(s,o)=>(l(),r(f,null,[a("div",N,[b(D,{class:w(i.value)},null,8,["class"]),a("div",I,[a("div",E,[b(A,{onToggleSidebar:m}),a("div",F,[R,a("div",q,[z,a("div",H,[J,a("div",L,[s.ready?_("",!0):(l(),r("p",K,"Loading...")),s.ready?(l(),B(C(y),{key:1,class:"display table table-striped"},{default:U(()=>[O,a("tbody",null,[(l(!0),r(f,null,k(s.piutangs,(t,h)=>(l(),r("tr",{key:t.id},[a("td",null,u(h+1),1),a("td",null,[a("div",G,[a("div",M,[a("button",{type:"button",class:"btn btn-success",onClick:g=>s.konfirmasiBayar(t.id,t.pihak_peminjam)},X,8,W)]),a("div",Y,[a("button",{type:"button",class:"btn btn-warning","data-toggle":"modal","data-target":"#aditPiutang",onClick:g=>s.setDataUpdate(t.pihak_peminjam,t.no_hp,t.jumlah_pinjaman,t.deskripsi_pinjaman,t.id)},aa,8,Z)]),a("div",ta,[a("button",{onClick:g=>s.konfirmasi(t.id,t.pihak_peminjam),class:"btn btn-danger customDetail"},na,8,ea)])])]),a("td",null,u(t.pihak_peminjam),1),a("td",null,u(t.no_hp),1),a("td",null,u(t.jumlah_pinjaman),1),a("td",null,u(t.deskripsi_pinjaman),1),a("td",null,[t.status=="0"?(l(),r("i",oa)):_("",!0),t.status=="1"?(l(),r("i",ia)):_("",!0)])]))),128))])]),_:1})):_("",!0)])]),la])])]),b(V)])]),a("div",ra,[a("div",da,[a("div",ua,[pa,a("div",ca,[a("form",null,[a("div",ma,[ha,d(a("input",{type:"text",class:"form-control",id:"piJam",placeholder:"masukkan pihak peminjam","onUpdate:modelValue":o[0]||(o[0]=t=>s.formPiutang.pihak_peminjam=t)},null,512),[[p,s.formPiutang.pihak_peminjam]])]),a("div",ga,[_a,d(a("input",{type:"number",class:"form-control",id:"noHp",placeholder:"masukkan nomor hp peminjam","onUpdate:modelValue":o[1]||(o[1]=t=>s.formPiutang.no_hp=t)},null,512),[[p,s.formPiutang.no_hp]])]),a("div",fa,[ba,d(a("input",{type:"number",class:"form-control",id:"jumpin",placeholder:"masukkan jumlah pinjaman","onUpdate:modelValue":o[2]||(o[2]=t=>s.formPiutang.jumlah_pinjaman=t)},null,512),[[p,s.formPiutang.jumlah_pinjaman]])]),a("div",ka,[va,d(a("select",{class:"form-select","onUpdate:modelValue":o[3]||(o[3]=t=>s.selectedEvent=t)},[Pa,(l(!0),r(f,null,k(s.events,t=>(l(),r("option",{key:t.id,value:t.id},u(t.nama_event)+" - "+u(t.tanggal_event),9,ja))),128))],512),[[P,s.selectedEvent]])]),a("div",ya,[wa,d(a("textarea",{class:"form-control",id:"keterangan",placeholder:"masukkan deskripsi","onUpdate:modelValue":o[4]||(o[4]=t=>s.formPiutang.deskripsi_pinjaman=t)},null,512),[[p,s.formPiutang.deskripsi_pinjaman]])])])]),a("div",Ba,[Ua,a("button",{type:"button",class:"btn blueButton",onClick:o[5]||(o[5]=(...t)=>s.createPiutang&&s.createPiutang(...t))}," Simpan ")])])])]),a("div",Ca,[a("div",Sa,[a("div",Da,[Aa,a("div",Va,[a("form",null,[a("div",$a,[Ta,d(a("input",{type:"text",class:"form-control",id:"piJam",placeholder:"masukkan pihak peminjam","onUpdate:modelValue":o[6]||(o[6]=t=>s.formUpdatePiutang.pihak_peminjam=t)},null,512),[[p,s.formUpdatePiutang.pihak_peminjam]])]),a("div",Na,[Ia,d(a("input",{type:"number",class:"form-control",id:"noHp",placeholder:"masukkan nomor hp","onUpdate:modelValue":o[7]||(o[7]=t=>s.formUpdatePiutang.no_hp=t)},null,512),[[p,s.formUpdatePiutang.no_hp]])]),a("div",Ea,[Fa,d(a("input",{type:"number",class:"form-control",id:"jumpin",placeholder:"masukkan jumlah pinjaman","onUpdate:modelValue":o[8]||(o[8]=t=>s.formUpdatePiutang.jumlah_pinjaman=t)},null,512),[[p,s.formUpdatePiutang.jumlah_pinjaman]])]),a("div",Ra,[qa,d(a("select",{class:"form-select","onUpdate:modelValue":o[9]||(o[9]=t=>s.selectedEvent=t)},[za,(l(!0),r(f,null,k(s.events,t=>(l(),r("option",{key:t.id,value:t.id},u(t.nama_event)+" - "+u(t.tanggal_event),9,Ha))),128))],512),[[P,s.selectedEvent]])]),a("div",Ja,[La,d(a("textarea",{class:"form-control",id:"keterangan",placeholder:"masukkan deskripsi","onUpdate:modelValue":o[10]||(o[10]=t=>s.formUpdatePiutang.deskripsi_pinjaman=t)},null,512),[[p,s.formUpdatePiutang.deskripsi_pinjaman]])])])]),a("div",Ka,[Oa,a("button",{type:"button",class:"btn blueButton",onClick:o[11]||(o[11]=(...t)=>s.updatePiutang&&s.updatePiutang(...t))}," Simpan ")])])])])],64))}});export{Za as default};
